<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBookPal</title>
    <link rel="stylesheet" href="cart.css" />
</head>

<body>
    <header>
        <div class="brand">MyBookPal</div>
        <nav>
            <ul class="nav-menu">
                <li><a href="#books" class="books-icon">Books</a></li>
                <li><a href="#ebooks" class="ebooks-icon">eBooks</a></li>
                <li><a href="#audiobooks" class="audiobooks-icon">Audiobooks</a></li>
                <li><a href="#bestsellers" class="bestsellers-icon">Bestsellers</a></li>
                <li><a href="#comingsoon" class="comingsoon-icon">Coming Soon</a></li>
                <li><a href="#giftcards" class="giftcards-icon">Gift Cards</a></li>
                <li><a href="#membership" class="membership_icon">Memberships</a></li>
            </ul>
        </nav>
        <ul class="user-menu">
            <li><a href="#account" class="account-icon">My Account</a></li>
            <li><a href="#wishlist" class="wishlist-icon">Wallet</a></li>
            <li><a href="#cart" class="cart-icon">Cart</a></li>
        </ul>
    </header>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search for books">
        <button>Search</button>
        <div class="order-filter">
            <label for="orderBy">Sort By:</label>
            <select id="orderBy">
                <option value="lowToHigh">Low to High</option>
                <option value="highToLow">High to Low</option>
            </select>
        </div>
    </div>
    <div class="container">
        <table id="cart">
            <thead>
                <tr>
                    <th class="third">Product</th>
                    <th class="second">Quantity</th>
                    <th class="fourth">Total</th>
                    <th class="fifth">&nbsp;</th>
                </tr>
            </thead>
            <tbody id="cartDetails"></tbody>
            <!-- tax + subtotal -->
            <tr class="extracosts">
                <td class="light">Shipping &amp; Tax</td>
                <td colspan="2" class="light"></td>
                <td>$35.00</td>
                <td>&nbsp;</td>
            </tr>
            <tr class="totalprice">
                <td class="light">Total:</td>
                <td colspan="2">&nbsp;</td>
                <td colspan="2"><span class="thick">$225.45</span></td>
            </tr>

            <tr class="checkoutrow">
                <td colspan="5" class="checkout-container">
                    <button id="submitbtn">Purchase Now!</button>
                </td>
            </tr>
    
            <!-- wallet btn -->
            <tr class="checkoutrow">
                <td colspan="5" class="wallet-container">
                    <button id="walletbtn">Go to Wallet</button>
                </td>
            </tr>


        </table>

        
        
    </div>
    <script>
        const serverURL = 'http://localhost:3000';
        const userId = 5;

        // Display cart details on page load
        document.addEventListener("DOMContentLoaded", function () {
            displayCartDetails(userId);
        });

        // Function to fetch cart details
        async function fetchCartDetails(userId) {
            try {
                const response = await fetch(`${serverURL}/view_cart?id=${userId}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching cart details:', error.message);
                throw error; // Propagate the error
            }
        }

        // Function to fetch book details
        async function fetchBookDetails(bookId) {
            try {
                const response = await fetch(`${serverURL}/get_book_details?id=${bookId}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching book details:', error.message);
                throw error; // Propagate the error
            }
        }

        // Function to display cart details on the page
        async function displayCartDetails(userId) {
            const cartDetails = await fetchCartDetails(userId);

            if (cartDetails.length > 0) {
                const tbody = document.getElementById('cartDetails');
                const bookDetailsPromises = cartDetails.map(async item => {
                    const bookDetails = await fetchBookDetails(item.BookID);
                    // const totalPriceResponse = await fetch(`/compute_price?user_id=${userId}`);
                    // const totalPriceData = await totalPriceResponse.json();
                    // const totalCartPrice = totalPriceData.total_price;

// Update the total price element in the HTML
document.querySelector('.totalprice td span.thick').innerText = `$${totalCartPrice}`;
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${bookDetails[0].Title}</td>
                        <td>${item.Quantity}</td>
                        <td>${totalPrice.toFixed(2)}</td>
                        <td><span class="remove" onclick="removeItem(this)"><img
                                    src="https://i.imgur.com/h1ldGRr.png" alt="X"></span></td>
                    `;
                    tbody.appendChild(tr);
                });

                await Promise.all(bookDetailsPromises);
            } else {
                // No items in the cart
                document.getElementById('cartDetails').innerHTML = 'No items in the cart.';
            }
        }

        // Function to remove an item from the cart
        function removeItem(element) {
            // Implement the logic to remove the corresponding item from the cart
            const row = element.closest('tr');
            row.parentNode.removeChild(row);
        }
    </script>
</body>

</html>
